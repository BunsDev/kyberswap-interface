import React, { memo, useMemo } from 'react'
import { useWindowSize } from 'hooks/useWindowSize'
import styled from 'styled-components'
import { X } from 'react-feather'
import { ExternalLink } from 'theme'
import useTheme from 'hooks/useTheme'
import { Flex } from 'rebass'
import { useLocalStorage } from 'react-use'
import { Autoplay, Navigation, Pagination } from 'swiper'
import { Swiper, SwiperSlide } from 'swiper/react/swiper-react'

import B1_Desktop from 'assets/banners/banner_1_desktop.png'
import B1_Tablet from 'assets/banners/banner_1_tablet.png'
import B1_Mobile from 'assets/banners/banner_1_mobile.png'
import B2_Desktop from 'assets/banners/banner_2_desktop.png'
import B2_Tablet from 'assets/banners/banner_2_tablet.png'
import B2_Mobile from 'assets/banners/banner_2_mobile.png'

import LM_Desktop from 'assets/banners/LM-desktop.png'
import LM_Tablet from 'assets/banners/LM-tablet.png'
import LM_Mobile from 'assets/banners/LM-mobile-300dpi.png'

import ReferralCampaignDesktop from 'assets/banners/referral-campaign-desktop.png'
import ReferralCampaignTablet from 'assets/banners/referral-campaign-tablet.png'
import ReferralCampaignMobile from 'assets/banners/referral-campaign-mobile.png'

import CommunityAMALivestreamWithCEODesktop from 'assets/banners/community-ama-livestream-with-ceo-desktop.png'
import CommunityAMALivestreamWithCEOTablet from 'assets/banners/community-ama-livestream-with-ceo-tablet.png'
import CommunityAMALivestreamWithCEOMobile from 'assets/banners/community-ama-livestream-with-ceo-mobile.png'

import KyberSwapTradingCampaignAcross5ChainsDesktop from 'assets/banners/kyberswap-trading-campaign-across-5-chains-desktop.png'
import KyberSwapTradingCampaignAcross5ChainsTablet from 'assets/banners/kyberswap-trading-campaign-across-5-chains-tablet.png'
import KyberSwapTradingCampaignAcross5ChainsMobile from 'assets/banners/kyberswap-trading-campaign-across-5-chains-mobile.png'

const BannerWrapper = styled(Flex)`
  --swiper-navigation-size: 12px;

  .swiper-button-prev,
  .swiper-button-next {
    color: #ffffff;
    background: rgba(0, 0, 0, 0.25);
    width: 32px;
    height: 32px;
    margin-top: 0;
    border-radius: 50%;
    transform: translateY(-50%);
    visibility: hidden;
  }

  .swiper-pagination-bullet {
    height: 5px;
    width: 5px;
    background: #d5dbde;
  }

  .swiper-pagination-bullet-active {
    width: 20px;
    border-radius: 4px;
    background: #ffffff;
  }

  &:hover {
    .swiper-button-prev,
    .swiper-button-next {
      visibility: visible;
    }
  }
`

const Wrapper = styled.div`
  margin: auto;
  position: relative;
  width: 100%;
  border-radius: 8px;
  overflow: hidden;

  img {
    border-radius: 8px;
  }
  @media screen and (min-width: 1100px) {
    max-width: 1054px;
  }
  @media screen and (min-width: 1240px) {
    max-width: 1154px;
  }
  @media screen and (min-width: 1320px) {
    max-width: 1226px;
  }
  @media screen and (min-width: 1500px) {
    max-width: 1394px;
  }
`

const Close = styled(X)`
  position: absolute;
  top: 0;
  right: 0;
  background: ${({ theme }) => theme.buttonBlack + '66'};
  padding: 4px;
  cursor: pointer;
  border-bottom-left-radius: 8px;
`

function Banner({
  margin,
  padding,
  maxWidth,
  isInModal = false,
}: {
  margin?: string
  padding?: string
  maxWidth?: string
  isInModal?: boolean
}) {
  const size = useWindowSize()
  const w = size?.width || 0
  const theme = useTheme()

  const ALL_BANNERS = [
    {
      // KyberSwap Trading Campaign Across 5 Chains
      id: 'kyberSwap-trading-campaign-across-5-chains',
      start: new Date(1656979200000), // July 5, 2022 0:00:00
      end: new Date(1657900800000), // July 15, 2022 16:00:00
      img: isInModal
        ? KyberSwapTradingCampaignAcross5ChainsMobile
        : w > 768
        ? KyberSwapTradingCampaignAcross5ChainsDesktop
        : w > 500
        ? KyberSwapTradingCampaignAcross5ChainsTablet
        : KyberSwapTradingCampaignAcross5ChainsMobile,
      link:
        'https://kyberswap.com/campaigns?selectedCampaignId=1&utm_source=kyberswap&utm_medium=banner&utm_campaign=tradingleaderboard&utm_content=onsite',
    },
    {
      // Community AMA livestream with CEO
      id: 'community-ama-livestream-with-ceo',
      start: new Date(1654473600000), // June 6, 2022 0:00:00
      end: new Date(1654905599000), // June 10, 2022 23:59:59
      img: isInModal
        ? CommunityAMALivestreamWithCEOMobile
        : w > 768
        ? CommunityAMALivestreamWithCEODesktop
        : w > 500
        ? CommunityAMALivestreamWithCEOTablet
        : CommunityAMALivestreamWithCEOMobile,
      link: 'https://twitter.com/KyberNetwork/status/1533697331463303169',
    },
    {
      // REFERRAL CAMPAIGN
      id: 'referral-campaign',
      start: new Date(1653004800000), // May 20, 2022 0:00:00
      end: new Date(1653609599000), // May 26, 2022 23:59:59
      img: isInModal
        ? ReferralCampaignMobile
        : w > 768
        ? ReferralCampaignDesktop
        : w > 500
        ? ReferralCampaignTablet
        : ReferralCampaignMobile,
      link: isInModal
        ? 'https://blog.kyber.network/introducing-kyberswaps-referral-campaign-2000-in-knc-rewards-up-for-grabs-when-you-share-1966da343e28#%2Fswap%3FnetworkId=1&utm_source=onsite-banner&utm_medium=window-popup&utm_campaign=referral-May2022'
        : 'https://blog.kyber.network/introducing-kyberswaps-referral-campaign-2000-in-knc-rewards-up-for-grabs-when-you-share-1966da343e28#%2Fswap%3FnetworkId=1&utm_source=onsite-banner&utm_medium=home-top-banner&utm_campaign=referral-May2022',
    },
    {
      // BTTC Liquidity Mining.
      id: 'bttc-liquidity-mining',
      start: new Date(1650585600000), // April 22, 2022 0:00:00
      end: new Date(1654041599000), // May 31, 2022 23:59:59
      img: isInModal ? B2_Mobile : w > 768 ? B2_Desktop : w > 500 ? B2_Tablet : B2_Mobile,
      // img: B2_Mobile,
      link:
        'https://blog.kyber.network/kyberswap-leads-dex-integration-with-bittorrent-chain-providing-liquidity-and-accessibility-across-2da780082b19?source=collection_home---4------0-----------------------',
    },
    {
      // BTTC Liquidity Mining.
      id: 'bttc-liquidity-mining-2',
      start: new Date(1650585600000), // April 22, 2022 0:00:00
      end: new Date(1654041599000), // May 31, 2022 23:59:59
      img: isInModal ? B1_Mobile : w > 768 ? B1_Desktop : w > 500 ? B1_Tablet : B1_Mobile,
      link:
        'https://blog.kyber.network/kyberswap-leads-dex-integration-with-bittorrent-chain-providing-liquidity-and-accessibility-across-2da780082b19?source=collection_home---4------0-----------------------',
    },
    {
      // AVAX LM
      id: 'avax-lm',
      start: new Date(1647820800000), // March 21, 2022 0:00:00
      end: new Date(1654041599000), // May 31, 2022 23:59:59
      img: isInModal ? LM_Mobile : w > 768 ? LM_Desktop : w > 500 ? LM_Tablet : LM_Mobile,
      link:
        'https://kyberswap.com/?utm_source=kyberswap&utm_medium=banner&utm_campaign=avaxphase2&utm_content=lm#/farms?networkId=43114',
    },
  ]

  const [_showBanner, setShowBanner] = useLocalStorage('show-banner-' + ALL_BANNERS[0].id, true)
  const banners = ALL_BANNERS.filter(b => {
    const date = new Date()
    return date >= b.start && date <= b.end
  })
  const showBanner = useMemo(() => _showBanner && banners.length, [_showBanner, banners.length])

  if (!showBanner) return null

  return (
    <BannerWrapper margin={margin || 'auto'} padding={padding} maxWidth={maxWidth || '1394px'} width="100%">
      <Swiper
        autoplay={banners.length > 1 ? { delay: isInModal ? 2000 : 20000 } : false}
        slidesPerView={1}
        navigation={true}
        pagination={true}
        loop={true}
        modules={[Navigation, Pagination, Autoplay]}
      >
        {banners.map((banner, index) => (
          <SwiperSlide key={index}>
            <Wrapper>
              <ExternalLink href={banner.link}>
                <img src={banner.img} alt="banner" width="100%" />
              </ExternalLink>
              <Close color={theme.white} role="button" onClick={() => setShowBanner(false)} />
            </Wrapper>
          </SwiperSlide>
        ))}
      </Swiper>
    </BannerWrapper>
  )
}

export default memo(Banner)
